extends layout

block link
  -var selected = 'Formulas';

block content
  div.card-tabs
    ul.nav.nav-tabs
      li.active
        a(data-toggle='tab', href='#formula-table') Formulas
      li.adminOnly.hide
        a(data-toggle='tab', href='#add_formula') Create

    .tab-content
      #formula-table.tab-pane.fade.in.active
        div.card
          div.card-header(data-background-color='purple')
            h4.title Formulas
          div.card-content.table-response
            table.table#formulaTable
              thead.text-primary
                th(onclick='sortTable(0, \'formula\')') Formula
                th(onclick='sortTable(1, \'formula\')') Description
                th(onclick='sortTable(2, \'formula\')') Ingredients
                th(onclick='sortTable(3, \'formula\')') Number of Units Produced
              tbody
              each formula in formulas
                tr
                  td
                    a(href='/formulas/' + formula.name)= formula.name
                  td= formula.description
                  td
                    each tuple in formula.tuples
                      a(href='/ingredients/' + tuple.ingredient)= tuple.ingredient
                      | : #{tuple.quantity}
                      br
                  td= formula.units
      .card-content.tab-pane.fade#add_formula.adminOnly.hide
        h1= 'Create Formula'
        form(action='/formulas/new', method='post')
          .form-group
            label.control-label Formula Name
            input.form-control(type='text', name='name', required='')
          .form-group
            label.control-label Description
            textarea.form-control(name='description' rows='5' cols='100')
          div.tupleRow
            .row
              .col-md-11
                .row#tuple1
                  .col-md-6
                    .form-group
                    label.control-label Ingredient
                    input#ingredient1.form-control(type='text', name='ingredient1', required='')
                  .col-md-6
                    .form-group
                    label.control-label Quantity
                    input#quantity1.form-control(type='number', name='quantity1', min='0', step='0.01', required='')
              .col-md-1
                p
                  br
                button#btn1.btn.btn-round.btn-just-icon.add-more(type='button', value='add')
                  i.material-icons add
          .form-group
            label.control-label Number of Units Produced
            input.form-control(type='number', name='units', min='0', required='')
          button.btn.btn-primary.pull-right(type='submit', value='add vendor') Add Formula

block scripts
  script.
    loadAdminContent();
  script.
    $(document).ready(function() {
      var next = 1;
      $(".add-more").click(function(e){
          e.preventDefault();
          var addTo = "#tuple" + next;
          next = next + 1;

          var newHTML = '<div id="tuple' + next + '" class="row">';
          newHTML += '<div class="col-md-6"><div class="form-group"></div><label class="control-label">Ingredient</label>';
          newHTML += '<input class="form-control" id="ingredient' + next + '" type="text" name="ingredient' + next + '"/></div>';
          newHTML += '<div class="col-md-6"><div class="form-group"></div><label class="control-label">Quantity</label>';
          newHTML += '<input class="form-control" id="quantity' + next + '" type="number" name="quantity' + next + '" min="0" step="0.01"/></div></div>';
          var newInput = $(newHTML);
          $(addTo).after(newInput);
          $("#tuple" + next).attr('data-source',$(addTo).attr('data-source'));

          /*var addIngredient = "#ingredient" + next;
          var addQuantity = "#quantity" + next;
          next = next + 1;
          var ingredientHTML = '<input class="input form-control" id="ingredient' + next + '" name="ingredient' + next + '" type="text">';
          var quantityHTML = '<input class="input form-control" id="quantity' + next + '" name="quantity' + next + '" type="text">';
          var newIngredientInput = $(ingredientHTML);
          var newQuantityInput = $(quantityHTML);
          $(addIngredient).after(newIngredientInput);
          $(addQuantity).after(newQuantityInput);
          $("#ingredient" + next).attr('data-source',$(addIngredient).attr('data-source'));
          $("#quantity" + next).attr('data-source',$(addIngredient).attr('data-source'));*/
      });
    });
